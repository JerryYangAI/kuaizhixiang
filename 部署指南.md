# 快纸箱网站 - Cloudflare Pages 部署指南

## 📋 快速开始

### 第一步：准备代码

1. **确保代码已提交到 Git**
   ```bash
   cd paperboxproject
   git add .
   git commit -m "准备部署到 Cloudflare Pages"
   git push
   ```

2. **如果没有 Git 仓库，先创建并推送到 GitHub**
   - 在 GitHub 创建新仓库
   - 将代码推送到仓库

### 第二步：在 Cloudflare Pages 创建项目

1. **登录 Cloudflare Dashboard**
   - 访问：https://dash.cloudflare.com/
   - 使用您的 Cloudflare 账号登录

2. **创建 Pages 项目**
   - 点击左侧菜单 **Pages**
   - 点击 **Create a project**
   - 选择 **Connect to Git**
   - 授权 Cloudflare 访问您的 GitHub/GitLab/Bitbucket
   - 选择包含 `paperboxproject` 的仓库

3. **配置构建设置**
   
   在项目设置页面填写以下信息：
   
   ```
   项目名称: kuaizhixiang
   生产分支: main (或 master)
   框架预设: Next.js
   构建命令: npm run build
   构建输出目录: .next
   根目录: paperboxproject (如果项目在子目录中)
   Node.js 版本: 20
   ```

### 第三步：配置环境变量

在 **Environment variables** 部分添加：

**必需的环境变量：**
```
NEXT_PUBLIC_BASE_URL = https://kuaizhixiang.com
```

**Stripe 支付（如果使用生产环境）：**
```
STRIPE_SECRET_KEY = sk_live_你的生产密钥
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY = pk_live_你的生产密钥
```

⚠️ **重要**：
- 使用生产环境的 Stripe 密钥（sk_live_ 和 pk_live_）
- 不要使用测试密钥（sk_test_ 和 pk_test_）
- 可以在 Stripe Dashboard 中获取生产密钥

### 第四步：配置自定义域名

1. **在项目设置中**
   - 进入 **Custom domains** 标签
   - 点击 **Set up a custom domain**
   - 输入：`kuaizhixiang.com`
   - 点击 **Continue**

2. **DNS 配置**
   - 如果域名在 Cloudflare 管理，系统会自动配置 DNS
   - 如果不在 Cloudflare，需要手动添加 CNAME 记录：
     - 类型：CNAME
     - 名称：@
     - 目标：kuaizhixiang.pages.dev（或 Cloudflare 提供的域名）

3. **SSL 证书**
   - Cloudflare 会自动配置免费 SSL 证书
   - 等待几分钟让证书生效

### 第五步：部署

1. **点击 "Save and Deploy"**
2. **等待构建完成**（通常 2-5 分钟）
3. **查看构建日志**，确保没有错误

### 第六步：验证

部署成功后，访问：
- ✅ https://kuaizhixiang.com
- ✅ https://www.kuaizhixiang.com
- ✅ https://kuaizhixiang.pages.dev（默认域名）

---

## 🔧 常见问题

### 1. 构建失败

**问题**：构建过程中出现错误

**解决方案**：
- 检查构建日志中的具体错误信息
- 确保 Node.js 版本设置为 20
- 检查 `package.json` 中的依赖是否正确
- 确保所有环境变量都已正确配置

### 2. 域名无法访问

**问题**：部署成功但域名无法访问

**解决方案**：
- 等待 DNS 传播（最多 24 小时）
- 检查 DNS 记录是否正确
- 确认 SSL 证书状态为 "Active"
- 清除浏览器缓存后重试

### 3. API Routes 不工作

**问题**：API 路由返回错误

**解决方案**：
- Cloudflare Pages 支持 Next.js API Routes
- 检查 API 路由代码是否正确
- 查看 Cloudflare Pages Functions 日志

### 4. 环境变量不生效

**问题**：环境变量在部署后不生效

**解决方案**：
- 确保环境变量名称正确（区分大小写）
- 重新部署项目（环境变量更改后需要重新部署）
- 检查环境变量是否在正确的环境中（Production/Preview）

---

## 📝 后续更新

### 自动部署

每次推送到主分支（main/master），Cloudflare Pages 会自动：
1. 检测代码变更
2. 重新构建项目
3. 部署新版本

### 预览部署

每个 Pull Request 都会自动创建预览部署，方便测试。

### 回滚

如果需要回滚到之前的版本：
1. 进入 Cloudflare Pages 项目
2. 点击 **Deployments**
3. 找到要回滚的版本
4. 点击 **Retry deployment** 或 **Rollback to this deployment**

---

## 🔐 安全建议

1. **不要提交敏感信息**
   - `.env.local` 文件已在 `.gitignore` 中
   - 所有敏感信息通过环境变量配置

2. **使用生产环境密钥**
   - Stripe 使用生产环境密钥（sk_live_ 和 pk_live_）
   - 不要在生产环境使用测试密钥

3. **定期更新依赖**
   ```bash
   npm audit
   npm update
   ```

---

## 📞 需要帮助？

如果遇到问题：
1. 查看 Cloudflare Pages 文档：https://developers.cloudflare.com/pages/
2. 查看构建日志中的错误信息
3. 检查 Next.js 部署文档：https://nextjs.org/docs/deployment

---

## ✅ 部署检查清单

部署前请确认：

- [ ] 代码已推送到 Git 仓库
- [ ] 在 Cloudflare Pages 创建了项目
- [ ] 配置了正确的构建设置
- [ ] 添加了所有必需的环境变量
- [ ] 配置了自定义域名
- [ ] 本地测试通过（`npm run build` 成功）
- [ ] 域名 DNS 记录正确
- [ ] SSL 证书已激活

完成以上步骤后，您的网站就可以通过 https://kuaizhixiang.com 访问了！🎉

